# SquFibo E2Eテスト仕様書（一人稽古モード）

## バージョン
v1.0.0 (2026-01-28)

---

## 1. 一人稽古モードについて

SquFiboは以下の2つのモードを提供する予定です：
- **一人稽古モード**（本仕様の対象）: 将棋の「一人二役対局」のように、1人のプレイヤーが上側・下側の両方を操作し、戦術研究や練習を行うモード
- **対CPUモード**（今後実装予定）: コンピューター相手に対戦するモード

本仕様書は、まず実装する「一人稽古モード」のE2Eテストを定義します。

---

## 2. テストの目的

本ドキュメントは、SquFiboゲームのEnd-to-End（E2E）テストにおける検証項目を定義する。
一人稽古モード（一人二役対局）を前提とし、1人のプレイヤーが上側・下側の両方を操作する形式でテストする。

---

## 3. テスト環境

### 3.1 前提条件
- ブラウザ: Chrome, Firefox, Safari（最新版）
- アプリケーション起動: `npm run dev` で開発サーバーが起動していること
- テストURL: `http://localhost:5173/` （デフォルト）

### 3.2 テストデータ
- カード構成: 赤1×8、青1×8、赤4×8、青4×8、赤9×8、青9×8、赤16×8、青16×8（合計64枚）
- 初期星数: 34個
- 初期手札: 上側、下側それぞれ13枚ずつ

---

## 4. テストケース一覧

### 4.1 ゲーム開始テスト

#### TC-001: 初期画面表示
**目的**: ゲーム起動時に正しい初期状態が表示されること

**手順**:
1. ブラウザでアプリケーションにアクセスする

**期待結果**:
- タイトル「SquFibo（すくふぃぼ）」が表示される
- 「新しいゲーム」ボタンが表示される
- 3×3の盤面が空の状態で表示される
- 下側プレイヤーの手札が13枚表向きで表示される
- 上側プレイヤーの手札が13枚表向きで表示される
- ゲームステータスに以下が表示される:
  - 残り星数: 34
  - 山札残数: 38（64 - 13×2）
  - 下側星: 0
  - 上側星: 0
- コメンタリーエリアに「ゲームを開始します」「下側のターンです」が表示される

---

### 4.2 カード配置テスト

#### TC-002: 通常のカード配置
**目的**: 手札からカードを選択して盤面に配置できること

**前提条件**: ゲームが開始され、下側プレイヤーのターンであること

**手順**:
1. 下側プレイヤーの手札から任意のカードをクリックする
2. 盤面の空いているマスをクリックする

**期待結果**:
- 手札でクリックしたカードが選択状態（ハイライト）になる
- 盤面の空きマスがハイライト表示される
- 空きマスをクリックすると、選択したカードが盤面に配置される
- 手札からカードが1枚減る
- コメンタリーエリアに配置したカードの情報（色と値）が表示される
- エラーメッセージが表示されない

#### TC-003: 既に配置済みのマスへの配置試行
**目的**: 既にカードが置かれているマスには配置できないこと

**前提条件**: 盤面に少なくとも1枚のカードが配置されていること

**手順**:
1. 手札からカードを選択する
2. 既にカードが配置されているマスをクリックする

**期待結果**:
- エラーメッセージ「そのマスには既にカードが配置されています」が表示される
- カードは配置されない

#### TC-004: カード未選択での配置試行
**目的**: 手札からカードを選択せずに配置できないこと

**前提条件**: 下側プレイヤーのターンであること

**手順**:
1. 手札からカードを選択せずに盤面の空きマスをクリックする

**期待結果**:
- エラーメッセージ「手札からカードを選択してください」が表示される
- カードは配置されない

#### TC-005: 手札0枚時の山札からの直接配置
**目的**: 手札が0枚の場合、山札から直接カードを引いて配置できること

**前提条件**:
- 現在のターンのプレイヤーの手札が0枚
- 山札が1枚以上残っていること

**手順**:
1. 盤面の空きマスをクリックする

**期待結果**:
- 山札の一番上のカードが自動的に盤面に配置される
- 山札残数が1減る
- コメンタリーエリアに「山札から直接カードを配置しました」と表示される
- 手札は0枚のまま

---

### 4.3 役の申告テスト

#### TC-006: 正しい役の申告（1-4ペア）
**目的**: 同色の1と4のペアを正しく申告できること

**前提条件**:
- 盤面に同色の1と4が配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上の同色の1のカードをクリックする
2. 盤面上の同色の4のカードをクリックする
3. 「役を申告」ボタンをクリックする

**期待結果**:
- 選択したカードが盤面から除去される
- 下側プレイヤーの星が2個増加する
- 下側プレイヤーの手札が2枚増加する（山札から2枚ドロー）
- 山札残数が2減る
- コメンタリーエリアに「1-4ペアを申告しました！★+2、カード2枚ドロー」と表示される

#### TC-007: 正しい役の申告（4-9ペア）
**目的**: 同色の4と9のペアを正しく申告できること

**前提条件**:
- 盤面に同色の4と9が配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上の同色の4のカードをクリックする
2. 盤面上の同色の9のカードをクリックする
3. 「役を申告」ボタンをクリックする

**期待結果**:
- 選択したカードが盤面から除去される
- 下側プレイヤーの星が2個増加する
- 下側プレイヤーの手札が2枚増加する
- 山札残数が2減る
- コメンタリーエリアに「4-9ペアを申告しました！★+2、カード2枚ドロー」と表示される

#### TC-008: 正しい役の申告（1-4-16トリプル）
**目的**: 同色の1、4、16のトリプルを正しく申告できること

**前提条件**:
- 盤面に同色の1、4、16が配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上の同色の1のカードをクリックする
2. 盤面上の同色の4のカードをクリックする
3. 盤面上の同色の16のカードをクリックする
4. 「役を申告」ボタンをクリックする

**期待結果**:
- 選択した3枚のカードが盤面から除去される
- 下側プレイヤーの星が3個増加する
- 下側プレイヤーの手札が3枚増加する
- 山札残数が3減る
- コメンタリーエリアに「1-4-16トリプルを申告しました！★+3、カード3枚ドロー」と表示される

#### TC-009: 異色のカードでの役申告（不正）
**目的**: 色が異なるカードでは役が成立しないこと

**前提条件**:
- 盤面に赤1と青4が配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上の赤1のカードをクリックする
2. 盤面上の青4のカードをクリックする
3. 「役を申告」ボタンをクリックする

**期待結果**:
- エラーメッセージ「おしい！選択したカードは役ではありません」が表示される
- カードは盤面に残る
- 星、手札、山札の数は変化しない

#### TC-010: 不正な数値の組み合わせでの役申告
**目的**: 役の定義に合わない数値の組み合わせは成立しないこと

**前提条件**:
- 盤面に同色の1と9が配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上の同色の1のカードをクリックする
2. 盤面上の同色の9のカードをクリックする
3. 「役を申告」ボタンをクリックする

**期待結果**:
- エラーメッセージ「おしい！選択したカードは役ではありません」が表示される
- カードは盤面に残る
- 星、手札、山札の数は変化しない

#### TC-011: カード未選択での役申告
**目的**: カードを選択せずに役を申告できないこと

**前提条件**: 下側プレイヤーのターンであること

**手順**:
1. 盤面のカードを選択せずに「役を申告」ボタンをクリックする

**期待結果**:
- エラーメッセージ「役を構成するカードを盤面から選択してください」が表示される
- ゲーム状態は変化しない

#### TC-012: 枚数不正（1枚のみ）での役申告
**目的**: 1枚のカードだけでは役を申告できないこと

**前提条件**: 下側プレイヤーのターンであること

**手順**:
1. 盤面上のカードを1枚だけクリックする
2. 「役を申告」ボタンをクリックする

**期待結果**:
- エラーメッセージ「役は2枚または3枚のカードで構成されます」が表示される
- ゲーム状態は変化しない

#### TC-013: 枚数不正（4枚以上）での役申告
**目的**: 4枚以上のカードでは役を申告できないこと

**前提条件**:
- 盤面に4枚以上のカードが配置されていること
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上のカードを4枚クリックする
2. 「役を申告」ボタンをクリックする

**期待結果**:
- エラーメッセージ「役は2枚または3枚のカードで構成されます」が表示される
- ゲーム状態は変化しない

---

### 4.4 盤面満杯時のテスト

#### TC-014: 盤面満杯時の警告表示
**目的**: 盤面が満杯の場合、警告が表示されること

**前提条件**: 盤面の9マス全てにカードが配置されていること

**手順**:
1. 盤面の状態を確認する

**期待結果**:
- 現在のターンのプレイヤーエリアに「⚠️ 盤面が満杯です。盤面のカードのゴミ箱アイコンをクリックして廃棄するか、役を申告してください。」と表示される
- 盤面上の各カードにゴミ箱アイコンが表示される

#### TC-015: 盤面満杯時のカード廃棄
**目的**: 盤面が満杯の時、既存のカードを廃棄できること

**前提条件**:
- 盤面の9マス全てにカードが配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上のいずれかのカードのゴミ箱アイコンをクリックする
2. 確認ダイアログで「OK」をクリックする

**期待結果**:
- 確認ダイアログ「盤面の[色][数値]を捨てますか？」が表示される
- 選択したカードが盤面から除去される
- コメンタリーエリアに「盤面の[色][数値]を廃棄しました」と表示される
- 星や手札の増減はない
- そのマスが空きマスになる

#### TC-016: 盤面満杯時のカード廃棄キャンセル
**目的**: 盤面満杯時のカード廃棄をキャンセルできること

**前提条件**:
- 盤面の9マス全てにカードが配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上のいずれかのカードのゴミ箱アイコンをクリックする
2. 確認ダイアログで「キャンセル」をクリックする

**期待結果**:
- カードは盤面に残る
- ゲーム状態は変化しない

---

### 4.5 ターン管理テスト

#### TC-017: ターン終了操作
**目的**: ターン終了ボタンでターンを終了できること

**前提条件**:
- 下側プレイヤーのターンであること
- カードが配置済みであること

**手順**:
1. 「ターン終了」ボタンをクリックする

**期待結果**:
- コメンタリーエリアに「上側のターンです」と表示される
- ターンが上側プレイヤーに移る
- 「役を申告」「ターン終了」ボタンは引き続き有効（一人二役なので常に操作可能）

#### TC-018: ターン交代の動作確認
**目的**: ターンが正しく上側・下側間で切り替わること

**前提条件**: ゲームが進行中であること

**手順**:
1. 下側プレイヤーのターンで「ターン終了」をクリックする
2. 上側プレイヤーのターンで「ターン終了」をクリックする

**期待結果**:
- 下側→上側→下側とターンが正しく切り替わる
- コメンタリーエリアに現在のターン情報が表示される
- 各ターンで対応する手札が操作可能になる

---

### 4.6 特殊ケーステスト

#### TC-019: 山札残り枚数不足時の役申告
**目的**: 役申告時に山札が不足している場合、引ける分だけ引けること

**前提条件**:
- 山札残数が1枚
- 盤面に役が成立する状態（例: 同色の1と4）が整っている
- 下側プレイヤーのターンであること

**手順**:
1. 役を構成する2枚のカードを選択する
2. 「役を申告」ボタンをクリックする

**期待結果**:
- 役が成立し、カードが除去される
- 下側プレイヤーの星が2個増加する
- 下側プレイヤーの手札が1枚だけ増加する（山札が1枚しかないため）
- 山札残数が0になる

#### TC-020: 星残り数不足時の役申告
**目的**: 役申告時に星が不足している場合、獲得できる分だけ獲得できること

**前提条件**:
- 残り星数が1個
- 盤面に役が成立する状態（例: 同色の1と4）が整っている
- 下側プレイヤーのターンであること

**手順**:
1. 役を構成する2枚のカードを選択する
2. 「役を申告」ボタンをクリックする

**期待結果**:
- 役が成立し、カードが除去される
- 下側プレイヤーの星が1個だけ増加する（残り星数が1個しかないため）
- 下側プレイヤーの手札が2枚増加する
- 残り星数が0になる

---

### 4.7 ゲーム終了テスト

#### TC-021: 星全獲得によるゲーム終了
**目的**: 全ての星が獲得されたときにゲームが終了すること

**前提条件**: 残り星数が2個以下で、役を申告できる状態

**手順**:
1. 役を申告して残り星数を0にする
2. ターン終了する

**期待結果**:
- ゲーム終了モーダルが表示される
- 「ゲーム終了！」の見出しが表示される
- 最終スコアが表示される（下側: X個、上側: Y個）
- スコア差が明示される
- 「新しいゲーム」ボタンが表示される

#### TC-022: 山札枯渇によるゲーム終了
**目的**: 山札が0枚になったときにゲームが終了すること

**前提条件**: 山札残数が少ない状態（1〜3枚程度）

**手順**:
1. 役を申告またはカード配置により山札を消費する
2. ターン終了して山札を0枚にする

**期待結果**:
- ゲーム終了モーダルが表示される
- 最終スコアが表示される（下側: X個、上側: Y個）
- スコア差が明示される

#### TC-023: 同点でのゲーム終了
**目的**: 両サイドの星数が同じ場合、同点と表示されること

**前提条件**:
- 下側と上側の星数が同じ
- ゲーム終了条件を満たしている

**手順**:
1. ゲーム終了処理を発動させる

**期待結果**:
- ゲーム終了モーダルに「同点！」または「引き分け！」と表示される
- 最終スコアが表示される（下側: X個、上側: X個）

#### TC-024: ゲーム終了後の操作不可
**目的**: ゲーム終了後は操作ができないこと

**前提条件**: ゲームが終了している

**手順**:
1. 手札のカードをクリックする
2. 盤面をクリックする
3. 「役を申告」ボタンをクリックする

**期待結果**:
- 「役を申告」「ターン終了」ボタンが無効化されている
- 操作によるゲーム状態の変更はない

---

### 4.8 ゲームリセットテスト

#### TC-025: ゲーム途中でのリセット
**目的**: ゲーム途中で「新しいゲーム」ボタンを押すと新規ゲームが開始されること

**前提条件**: ゲームが進行中である

**手順**:
1. 画面上部の「新しいゲーム」ボタンをクリックする

**期待結果**:
- 盤面がクリアされる（全マス空）
- 下側、上側の手札がそれぞれ13枚にリセットされる
- 星数が初期状態（下側: 0、上側: 0、残り: 34）にリセットされる
- 山札残数が38枚にリセットされる
- コメンタリーエリアに「ゲームを開始します」「下側のターンです」が表示される
- 下側プレイヤーのターンで開始される

#### TC-026: ゲーム終了後のリセット
**目的**: ゲーム終了後、モーダル内の「新しいゲーム」ボタンで新規ゲームが開始されること

**前提条件**: ゲームが終了している

**手順**:
1. ゲーム終了モーダル内の「新しいゲーム」ボタンをクリックする

**期待結果**:
- ゲーム終了モーダルが閉じる
- 新規ゲームが開始される（TC-025と同様の初期状態）

---

### 4.9 UI/UXテスト

#### TC-027: 手札カードの選択状態表示
**目的**: 手札のカードを選択すると視覚的なフィードバックがあること

**前提条件**: 下側プレイヤーのターンであること

**手順**:
1. 手札の任意のカードをクリックする

**期待結果**:
- クリックしたカードがハイライト表示される
- 「選択中: [色] [数値]」の情報が表示される
- 盤面の空きマスがハイライト表示される
- 同じカードを再度クリックすると選択が解除される

#### TC-028: 盤面カード選択時の視覚的フィードバック
**目的**: 役申告のために盤面のカードを選択すると視覚的なフィードバックがあること

**前提条件**:
- 盤面にカードが配置されている
- 下側プレイヤーのターンであること

**手順**:
1. 盤面上の任意のカードをクリックする

**期待結果**:
- クリックしたカードがハイライト表示される
- 「申告用カード選択中: [N]枚」の情報が表示される
- 同じカードを再度クリックすると選択が解除される

#### TC-029: エラーメッセージの自動消去
**目的**: エラーメッセージが一定時間後に自動的に消えること

**前提条件**: 何らかの操作でエラーメッセージが表示されている

**手順**:
1. エラーが発生する操作を実行する
2. 3秒以上待機する

**期待結果**:
- エラーメッセージが表示される
- 3秒後に自動的にエラーメッセージが消える

#### TC-030: 手札0枚時の通知表示
**目的**: 手札が0枚の場合、通知メッセージが表示されること

**前提条件**:
- 現在のターンのプレイヤーの手札が0枚
- 山札が1枚以上残っている

**手順**:
1. 画面を確認する

**期待結果**:
- 現在のターンのプレイヤーエリアに「💡 手札がありません。空きマスをクリックすると山札から直接配置できます。」と表示される

---

## 5. 実行環境別の考慮事項

### 5.1 ブラウザ固有のテスト
- **Chrome**: 基準ブラウザとして全テストケースを実行
- **Firefox**: レイアウト崩れ、イベント処理の互換性を確認
- **Safari**: レンダリング、アニメーションの動作を確認

### 5.2 レスポンシブデザインのテスト
- デスクトップ解像度（1920×1080）
- タブレット解像度（768×1024）
- モバイル解像度（375×667）

---

## 6. テスト実施記録

### 6.1 テスト実施者
- 実施者名: _______________
- 実施日: _______________

### 6.2 結果記録フォーマット

| テストケースID | テスト項目 | 結果 | 備考 |
|--------------|----------|------|-----|
| TC-001 | 初期画面表示 | ☐ Pass ☐ Fail | |
| TC-002 | 通常のカード配置 | ☐ Pass ☐ Fail | |
| ... | ... | ... | |

---

## 7. 補足事項

### 7.1 既知の制約
- 一人稽古モード専用（対CPUモードは別途実装予定）
- 複数役の同時申告は不可（1ターンに1役のみ）
- 役の自動検出機能はなし（手動申告が必要）
- 両方の手札が常に表示される（一人二役対局のため）

### 7.2 今後のテスト拡張
- 対CPUモードが実装された場合、CPU側の挙動テストを追加
- 棋譜記録機能が追加された場合、棋譜の保存・読込テストを追加
- パフォーマンステスト（大量操作時の応答速度）
- アクセシビリティテスト（キーボード操作、スクリーンリーダー対応）

---

## 8. 参考資料

- ゲーム仕様書: `docs/spec_ja.md`
- ソースコード: `src/` ディレクトリ
