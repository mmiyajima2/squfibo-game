# バグ対応

## [x] 役には自分が置いたカードを含める条件が聞いてない
- 自分は青1をおく
- 自分が置いてない(赤1, 赤4)を選ぶ
- 役を申告すると、役が成立してしまう
- かならず、今自分が置いたカードを含む必要がある
- **修正完了**: handleClaimCombo関数内で、placementHistoryを使って今のターンで配置したカードが役に含まれているかをチェックするバリデーションを追加


## [x] ターンの切り替えに不具合がある
- 下側が赤１を中央におく、ターン終了する
- 上側が赤４を中央におく、ターン終了する
- 下側のターンにならない、下側のターンになるべき
- **修正完了**: React Strict Modeでの二重実行時に、gameの状態とcurrentPlayerIndexSnapshotが不整合になる問題を修正。不整合が検出された場合、snapshotをgameの現在の状態に同期させるように変更


## [x] 一回のターンで、２枚のカードがおけてしまう
- 一回のターンにおけるのは、1枚のカードのみ
- そのターンで2枚配置しようとしたら、警告主旨のメッセージが必要
- **修正完了**: placementHistoryの長さをチェックし、1枚以上配置済みの場合はエラーメッセージを表示

## [x] (赤1, 赤4)でやくを成立させたのに相手のターンにならない
- 相手のターンになるべき
- 役の成立について、そのターンで一つしか解決・効果がでない、仕様なのですぐにターンが交代したほうがUXがよい
- 選んだカードで役が成立してなければ、不正解のメッセージを出して、ターンは変更しない.\
役が見抜けないプレイヤーは「ターン終了」ボタンでターンを渡すしかない
- **修正完了**: CLAIM_COMBOアクション内で自動的にendTurn()を呼び出すように変更。役申告成功後は必ずターンが切り替わる


## [x] (赤1, 赤4)でやくを成立させたのに星が４個獲得されている
- 一人二役の稽古モードのはなし
- 星は2個で、デッキから2個ドローのはず
- 1, 4, 16の3個役についても確認してほしい
- **修正完了**: CLAIM_COMBOアクションにReact StrictMode対策を追加（位置が既に空の場合はスキップ）

## [x] ターン終了しても相手のターンにならない-2
- （これは、一人二役の自主稽古モードのはなし）
- あなたの手札（下側）から、一つボードにおく
- ターン終了ボタンを押す
- 上側のターンにならない -> なるべき
- 実況エリアも下側のターンとでる
- 上側のターンになって、上側が配置できるべき
- 下側は不活性になるべき
- **修正完了**: ターンに応じて現在のプレイヤーの手札のみ操作可能に設定（isOpponentを動的に制御）

## [x] ターン終了しても相手のターンにならない
- あなたの手札（下側）から、一つボードにおく
- ターン終了ボタンを押す
- 上側のターンにならない -> なるべき
- **修正完了**: 一人二役モードで両プレイヤーを操作可能に変更（isPlayer1Turnガードを削除、位置ベースの実況を実装）

## [x] 一人二役稽古モードで実況エリアの表示がおかしい
- ゲームを開始します！が、2つダブって表示している
- これは一つであるべき
- **修正完了**: useRefを使用してStrictModeでの二重実行を防止

# 改善要望

## [x] それぞれの手札を整列したい
- 第一に、赤、青の順
- 第二に、数字の昇順
- **修正完了**: Hand.getCards()メソッドでカードを色（RED→BLUE）→数字（昇順）でソート

## [x] ターン終了の流れをかえたい
- 現状だと、「ターン終了」ボタンを教えて相手にターンを渡すとなる
- これはよいが、「役を申告」して成立した場合は、解決->効果ののち、相手にターンを渡してもよいとおもう
- まずは、実装まえにまず意見が欲しい

## [x] 一度カードおいて取取り消せようにしたい
- 現状は手札からボードにカードを押すと取り消せない
- 役を申告して成立が認められる\
あるいは、ターン終了ボタンをおす、までは取り消しできてよい
- 変更するまえに修正計画を示してほしい
- **修正完了**: 配置履歴をUIStateで管理し、「配置を取り消し」ボタンを実装